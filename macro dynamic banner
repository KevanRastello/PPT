Sub AddSectionLabelsWithHighlightBar()

    ' === USER SETTINGS ===
    Dim sectionInfo As Variant
    ' Change the number and name of the section
    sectionInfo = Array( _
        Array("Introduction", 3), _
        Array("Biology", 6), _
        Array("Model", 10), _
        Array("Take-home", 12), _
        Array("Conlusion", 13) _
    )
    
    Dim fontSizeText As Integer: fontSizeText = 16
    Dim fontName As String: fontName = "Calibri"
    
    Dim bannerTop As Single: bannerTop = 5
    Dim barHeight As Single: barHeight = 3
    Dim spacingPadding As Single: spacingPadding = 10  ' Extra space between labels

    Dim textColorActive As Long: textColorActive = RGB(0, 0, 0)
    Dim textColorInactive As Long: textColorInactive = RGB(150, 150, 150)
    Dim barColorActive As Long: barColorActive = textColorActive
    Dim barColorInactive As Long: barColorInactive = textColorInactive

    ' === INTERNAL SETUP ===
    Dim sectionCount As Integer: sectionCount = UBound(sectionInfo) - LBound(sectionInfo) + 1
    Dim sectionNames() As String, sectionStarts() As Integer, sectionEnds() As Integer
    ReDim sectionNames(sectionCount - 1)
    ReDim sectionStarts(sectionCount - 1)
    ReDim sectionEnds(sectionCount - 1)

    Dim i As Integer
    sectionStarts(0) = 1
    sectionEnds(0) = sectionInfo(0)(1)
    sectionNames(0) = sectionInfo(0)(0)
    For i = 1 To sectionCount - 1
        sectionNames(i) = sectionInfo(i)(0)
        sectionStarts(i) = sectionEnds(i - 1) + 1
        sectionEnds(i) = sectionInfo(i)(1)
    Next i

    Dim slideWidth As Single: slideWidth = ActivePresentation.PageSetup.slideWidth
    Dim slotWidth As Single: slotWidth = slideWidth / sectionCount
    Dim sld As Slide, shp As Shape
    Dim sldIndex As Integer, sectionIndex As Integer
    Dim isActive As Boolean, labelCenter As Single
    Dim labelWidth As Single, labelLeft As Single
    Dim labelTop As Single: labelTop = bannerTop

    ' === APPLY TO EACH SLIDE ===
    For Each sld In ActivePresentation.Slides
        sldIndex = sld.slideIndex

        ' Remove old elements
        For Each shp In sld.Shapes
            If Left(shp.Name, 14) = "SectionLabel_" Or Left(shp.Name, 13) = "SectionLine_" Then
                shp.Delete
            End If
        Next shp

        ' Determine current section
        sectionIndex = -1
        For i = 0 To sectionCount - 1
            If sldIndex >= sectionStarts(i) And sldIndex <= sectionEnds(i) Then
                sectionIndex = i
                Exit For
            End If
        Next i

        ' Add section labels and bars
        For i = 0 To sectionCount - 1
            isActive = (i = sectionIndex)
            labelCenter = i * slotWidth + slotWidth / 2

            ' Create text label
            Set shp = sld.Shapes.AddTextbox( _
                Orientation:=msoTextOrientationHorizontal, _
                Left:=0, Top:=labelTop, Width:=100, Height:=20)
            With shp
                .Name = "SectionLabel_" & i
                .TextFrame2.TextRange.Text = sectionNames(i)
                .TextFrame2.TextRange.Font.Size = fontSizeText
                .TextFrame2.TextRange.Font.Name = fontName
                .TextFrame2.TextRange.Font.Bold = isActive
                .TextFrame2.TextRange.Font.Fill.ForeColor.RGB = IIf(isActive, textColorActive, textColorInactive)
                .TextFrame2.TextRange.ParagraphFormat.Alignment = ppAlignCenter
                .TextFrame2.VerticalAnchor = msoAnchorMiddle
                .TextFrame2.AutoSize = msoAutoSizeShapeToFitText
                .Height = .Height + 4 ' Prevent clipping (like "n" being cut)
                .Line.Visible = msoFalse
            End With

            ' Reposition to center in slot
            labelWidth = shp.Width
            labelLeft = labelCenter - labelWidth / 2
            shp.Left = labelLeft

            ' Lock the label
            shp.LockAspectRatio = msoFalse
            shp.Locked = msoTrue

            ' Add underline bar
            Set shp = sld.Shapes.AddShape(msoShapeRectangle, _
                Left:=labelLeft, Top:=labelTop + shp.Height, Width:=labelWidth, Height:=barHeight)
            With shp
                .Name = "SectionLine_" & i
                .Fill.ForeColor.RGB = IIf(isActive, barColorActive, barColorInactive)
                .Line.Visible = msoFalse
                .LockAspectRatio = msoFalse
                .Locked = msoTrue
            End With
        Next i
    Next sld
End Sub
